"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[909],{14565:function(e,t,a){a.d(t,{z:function(){return c}});var r=a(57437),l=a(2265),s=a(61994),i=a(53335);let n={primary:"bg-primary-600 text-white hover:bg-primary-700 focus:ring-primary-500 disabled:bg-primary-300 disabled:cursor-not-allowed",secondary:"bg-gray-100 text-gray-900 dark:bg-gray-700 dark:text-gray-100 hover:bg-gray-200 dark:hover:bg-gray-600 focus:ring-gray-500 disabled:bg-gray-50 dark:disabled:bg-gray-800 disabled:text-gray-400",outline:"border-2 border-primary-600 text-primary-600 dark:border-primary-400 dark:text-primary-400 hover:bg-primary-50 dark:hover:bg-primary-900/20 focus:ring-primary-500 disabled:border-gray-300 disabled:text-gray-300 dark:disabled:border-gray-600 dark:disabled:text-gray-600",ghost:"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 focus:ring-gray-500 disabled:text-gray-400 dark:disabled:text-gray-600",danger:"bg-red-600 text-white hover:bg-red-700 focus:ring-red-500 disabled:bg-red-300 disabled:cursor-not-allowed"},o={sm:"px-3 py-1.5 text-sm font-medium rounded-md",md:"px-4 py-2 text-sm font-medium rounded-md",lg:"px-6 py-3 text-base font-medium rounded-lg"},c=(0,l.forwardRef)((e,t)=>{let{className:a,variant:l="primary",size:c="md",isLoading:d=!1,leftIcon:u,rightIcon:y,fullWidth:f=!1,disabled:m,children:p,...k}=e,g=m||d;return(0,r.jsxs)("button",{ref:t,className:(0,i.m6)((0,s.W)("inline-flex items-center justify-center font-medium","transition-colors duration-200 ease-in-out","focus:outline-none focus:ring-2 focus:ring-offset-2","dark:focus:ring-offset-gray-900",n[l],o[c],f&&"w-full",g&&"cursor-not-allowed opacity-60",a)),disabled:g,...k,children:[d&&(0,r.jsxs)("svg",{className:(0,s.W)("animate-spin","sm"===c?"h-3.5 w-3.5":"h-4 w-4",p||u||y?"mr-2":""),xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","aria-hidden":"true",children:[(0,r.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,r.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),!d&&u&&(0,r.jsx)("span",{className:"mr-2",children:u}),p,!d&&y&&(0,r.jsx)("span",{className:"ml-2",children:y})]})});c.displayName="Button",t.Z=c},51776:function(e,t,a){a.d(t,{sm:function(){return y},u_:function(){return u}});var r=a(57437),l=a(2265),s=a(54887),i=a(61994),n=a(53335),o=a(32489),c=a(14565);let d={sm:"max-w-sm",md:"max-w-md",lg:"max-w-lg",xl:"max-w-xl",full:"max-w-4xl"};function u(e){let{isOpen:t,onClose:a,title:u,description:y,children:f,size:m="md",showCloseButton:p=!0,closeOnOverlayClick:k=!0,closeOnEscape:g=!0,footer:h,className:b}=e,w=(0,l.useCallback)(e=>{"Escape"===e.key&&g&&a()},[g,a]);if((0,l.useEffect)(()=>(t&&(document.addEventListener("keydown",w),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",w),document.body.style.overflow="unset"}),[t,w]),!t)return null;let v=(0,r.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",role:"dialog","aria-modal":"true","aria-labelledby":u?"modal-title":void 0,children:[(0,r.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm animate-fade-in",onClick:e=>{e.target===e.currentTarget&&k&&a()},"aria-hidden":"true"}),(0,r.jsxs)("div",{className:(0,n.m6)((0,i.W)("relative w-full bg-white dark:bg-gray-800 rounded-xl shadow-2xl","animate-scale-in","max-h-[90vh] flex flex-col",d[m],b)),children:[(u||p)&&(0,r.jsxs)("div",{className:"flex items-start justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[(0,r.jsxs)("div",{children:[u&&(0,r.jsx)("h2",{id:"modal-title",className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:u}),y&&(0,r.jsx)("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:y})]}),p&&(0,r.jsx)(c.z,{variant:"ghost",size:"sm",onClick:a,className:"p-1.5 -mr-2 -mt-1","aria-label":"Close modal",children:(0,r.jsx)(o.Z,{className:"h-5 w-5"})})]}),(0,r.jsx)("div",{className:"flex-1 overflow-y-auto p-4",children:f}),h&&(0,r.jsx)("div",{className:"flex items-center justify-end gap-3 p-4 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900/50 rounded-b-xl",children:h})]})]});return(0,s.createPortal)(v,document.body)}function y(e){let{isOpen:t,onClose:a,onConfirm:l,title:s,message:i,confirmText:n="Confirm",cancelText:o="Cancel",variant:d="danger",isLoading:y=!1}=e;return(0,r.jsx)(u,{isOpen:t,onClose:a,title:s,size:"sm",showCloseButton:!1,footer:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(c.z,{variant:"secondary",onClick:a,disabled:y,children:o}),(0,r.jsx)(c.z,{variant:"danger"===d?"danger":"primary",onClick:l,isLoading:y,children:n})]}),children:(0,r.jsx)("p",{className:"text-gray-600 dark:text-gray-300",children:i})})}t.ZP=u},45553:function(e,t,a){a.d(t,{qD:function(){return n},wI:function(){return i}});var r=a(57437),l=a(2265);let s=(0,l.createContext)(void 0);function i(e){let{children:t}=e,[a,i]=(0,l.useState)(()=>{{let e=localStorage.getItem("darkMode");return null!==e?JSON.parse(e):window.matchMedia("(prefers-color-scheme: dark)").matches}}),[n,o]=(0,l.useState)("kanban"),[c,d]=(0,l.useState)(null),[u,y]=(0,l.useState)(!0),[f,m]=(0,l.useState)({isOpen:!1,type:null,data:null});l.useEffect(()=>{a?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark"),localStorage.setItem("darkMode",JSON.stringify(a))},[a]);let p=(0,l.useCallback)(()=>{y(e=>!e)},[]),k=(0,l.useCallback)(()=>{i(e=>!e)},[]),g=(0,l.useCallback)(e=>{m({isOpen:!0,type:"task",data:e})},[]),h=(0,l.useCallback)(e=>{m({isOpen:!0,type:"project",data:e})},[]),b=(0,l.useCallback)(e=>{m({isOpen:!0,type:"confirm",data:e})},[]),w=(0,l.useCallback)(()=>{m({isOpen:!0,type:"importExport",data:null})},[]),v=(0,l.useCallback)(()=>{m({isOpen:!1,type:null,data:null})},[]);return(0,r.jsx)(s.Provider,{value:{currentView:n,setCurrentView:o,currentProjectId:c,setCurrentProjectId:d,sidebarOpen:u,toggleSidebar:p,setSidebarOpen:y,modal:f,openTaskModal:g,openProjectModal:h,openConfirmModal:b,openImportExportModal:w,closeModal:v,darkMode:a,toggleDarkMode:k},children:t})}function n(){let e=(0,l.useContext)(s);if(void 0===e)throw Error("useApp must be used within an AppProvider");return e}},32464:function(e,t,a){a.d(t,{Gb:function(){return n},mZ:function(){return o}});var r=a(57437),l=a(2265),s=a(28223);let i=(0,l.createContext)(void 0);function n(e){let{children:t,projectId:a}=e,[n,o]=(0,l.useState)([]),[c,d]=(0,l.useState)(new Map),[u,y]=(0,l.useState)(!1),[f,m]=(0,l.useState)(null),p=(0,l.useMemo)(()=>a?n.filter(e=>!e.project_id||null===e.project_id||e.project_id===a):n.filter(e=>!e.project_id),[n,a]),k=(0,l.useCallback)(async e=>{y(!0),m(null);try{let t=await s.aP(e);o(t)}catch(e){m(e instanceof Error?e.message:"Failed to fetch custom fields")}finally{y(!1)}},[]),g=(0,l.useCallback)(async e=>{y(!0),m(null);try{let t=await s.KD(e);return o(e=>[...e,t]),t}catch(t){let e=t instanceof Error?t.message:"Failed to create custom field";throw m(e),Error(e)}finally{y(!1)}},[]),h=(0,l.useCallback)(async(e,t)=>{y(!0),m(null);try{let a=await s.Oq(e,t);return o(t=>t.map(t=>t.id===e?a:t)),a}catch(t){let e=t instanceof Error?t.message:"Failed to update custom field";throw m(e),Error(e)}finally{y(!1)}},[]),b=(0,l.useCallback)(async e=>{y(!0),m(null);try{await s.Hl(e),o(t=>t.filter(t=>t.id!==e))}catch(t){let e=t instanceof Error?t.message:"Failed to delete custom field";throw m(e),Error(e)}finally{y(!1)}},[]),w=(0,l.useCallback)(async e=>{y(!0),m(null);try{let t=await s.el(e);d(a=>{let r=new Map(a);return r.set(e.toString(),t),r})}catch(e){m(e instanceof Error?e.message:"Failed to fetch task custom fields")}finally{y(!1)}},[]),v=(0,l.useCallback)(async(e,t,a)=>{y(!0),m(null);try{let r=await s.e1(e,t,a);return d(a=>{let l=new Map(a),s=l.get(e.toString())||[],i=s.findIndex(e=>e.custom_field_id===t);if(i>=0){let t=[...s];t[i]=r,l.set(e.toString(),t)}else l.set(e.toString(),[...s,r]);return l}),r}catch(t){let e=t instanceof Error?t.message:"Failed to set custom field value";throw m(e),Error(e)}finally{y(!1)}},[]),C=(0,l.useCallback)(async(e,t)=>{y(!0),m(null);try{await s.P5(e,t),d(a=>{let r=new Map(a),l=r.get(e.toString())||[];return r.set(e.toString(),l.filter(e=>e.custom_field_id!==t)),r})}catch(t){let e=t instanceof Error?t.message:"Failed to delete custom field value";throw m(e),Error(e)}finally{y(!1)}},[]),x=(0,l.useCallback)(e=>{d(t=>{let a=new Map(t);return a.delete(e.toString()),a})},[]),E=(0,l.useCallback)(e=>n.find(t=>t.id===e),[n]),j=(0,l.useCallback)((e,t)=>{let a=c.get(e.toString());return null==a?void 0:a.find(e=>e.custom_field_id===t)},[c]),_=(0,l.useCallback)(()=>{m(null)},[]);return(0,l.useEffect)(()=>{k(a||void 0)},[k,a]),(0,r.jsx)(i.Provider,{value:{customFields:n,availableFields:p,taskFieldValues:c,loading:u,error:f,fetchCustomFields:k,createCustomField:g,updateCustomField:h,deleteCustomField:b,fetchTaskCustomFields:w,setTaskCustomField:v,deleteTaskCustomField:C,clearTaskFieldValues:x,getCustomFieldById:E,getTaskFieldValue:j,clearError:_},children:t})}function o(){let e=(0,l.useContext)(i);if(void 0===e)throw Error("useCustomFields must be used within a CustomFieldProvider");return e}},51339:function(e,t,a){a.d(t,{ib:function(){return n},u$:function(){return o}});var r=a(57437),l=a(2265),s=a(28223);let i=(0,l.createContext)(void 0);function n(e){let{children:t,projectId:a}=e,[n,o]=(0,l.useState)([]),[c,d]=(0,l.useState)(!1),[u,y]=(0,l.useState)(null),f=(0,l.useMemo)(()=>a?n.filter(e=>void 0===e.project_id||null===e.project_id||e.project_id===a):n,[n,a]),m=(0,l.useCallback)(async()=>{d(!0),y(null);try{let e=await s.kH();o(e)}catch(e){y(e instanceof Error?e.message:"Failed to fetch people")}finally{d(!1)}},[]),p=(0,l.useCallback)(async e=>{d(!0),y(null);try{let t=await s.kH(e);o(e=>{let a=new Set(e.map(e=>e.id)),r=t.filter(e=>!a.has(e.id));return[...e,...r]})}catch(e){y(e instanceof Error?e.message:"Failed to fetch people")}finally{d(!1)}},[]),k=(0,l.useCallback)(async e=>{d(!0),y(null);try{let t=await s.oO(e);return o(e=>[...e,t]),t}catch(t){let e=t instanceof Error?t.message:"Failed to create person";throw y(e),Error(e)}finally{d(!1)}},[]),g=(0,l.useCallback)(async(e,t)=>{d(!0),y(null);try{let a=await s.p6(e,t);return o(t=>t.map(t=>t.id===e?a:t)),a}catch(t){let e=t instanceof Error?t.message:"Failed to update person";throw y(e),Error(e)}finally{d(!1)}},[]),h=(0,l.useCallback)(async e=>{d(!0),y(null);try{await s.jt(e),o(t=>t.filter(t=>t.id!==e))}catch(t){let e=t instanceof Error?t.message:"Failed to delete person";throw y(e),Error(e)}finally{d(!1)}},[]),b=(0,l.useCallback)(()=>{y(null)},[]),w=(0,l.useCallback)(e=>n.find(t=>t.id===e),[n]);return(0,l.useEffect)(()=>{m()},[m]),(0,r.jsx)(i.Provider,{value:{people:n,projectPeople:f,loading:c,error:u,fetchPeople:m,fetchPeopleByProject:p,createPerson:k,updatePerson:g,deletePerson:h,clearError:b,getPersonById:w},children:t})}function o(){let e=(0,l.useContext)(i);if(void 0===e)throw Error("usePeople must be used within a PeopleProvider");return e}},5050:function(e,t,a){a.d(t,{vn:function(){return m},q2:function(){return f},XU:function(){return p}});var r=a(57437),l=a(2265);function s(e){return 1===e.length?e.toLowerCase():e}function i(e){let{shortcuts:t,enabled:a=!0,preventDefault:r=!0}=e,i=(0,l.useCallback)(e=>{if(a&&(!function(){let e=document.activeElement;if(!e)return!1;let t=e.tagName.toLowerCase();return!!("input"===t||"textarea"===t||"true"===e.getAttribute("contenteditable")||e.closest("form")||"textbox"===e.getAttribute("role"))}()||"Escape"===e.key)){for(let a of t)if(!1!==a.enabled&&function(e,t){if(s(e.key)!==s(t.key))return!1;if(t.ctrlKey||t.metaKey){if(navigator.platform.toUpperCase().indexOf("MAC"),t.ctrlKey&&!e.ctrlKey||t.metaKey&&!e.metaKey||!e.ctrlKey&&!e.metaKey)return!1}else if(e.ctrlKey&&!t.ctrlKey||e.metaKey&&!t.metaKey||e.shiftKey&&!t.shiftKey||e.altKey&&!t.altKey)return!1;return(void 0===t.shiftKey||e.shiftKey===t.shiftKey)&&(void 0===t.altKey||e.altKey===t.altKey)}(e,a)){r&&e.preventDefault(),a.action();return}}},[t,a,r]);(0,l.useEffect)(()=>(window.addEventListener("keydown",i),()=>{window.removeEventListener("keydown",i)}),[i])}var n=a(45553),o=a(94217);let c=[{id:"search",key:"/",description:"Focus search",category:"navigation",displayKey:"/"},{id:"new-task",key:"n",description:"Create new task",category:"actions",displayKey:"N"},{id:"new-project",key:"p",description:"Create new project",category:"actions",displayKey:"P"},{id:"view-dashboard",key:"1",description:"Go to Dashboard",category:"views",displayKey:"1"},{id:"view-kanban",key:"2",description:"Go to Kanban board",category:"views",displayKey:"2"},{id:"view-list",key:"3",description:"Go to List view",category:"views",displayKey:"3"},{id:"view-calendar",key:"4",description:"Go to Calendar",category:"views",displayKey:"4"},{id:"view-timeline",key:"5",description:"Go to Timeline",category:"views",displayKey:"5"},{id:"view-people",key:"6",description:"Go to People",category:"views",displayKey:"6"},{id:"help",key:"?",shiftKey:!0,description:"Show keyboard shortcuts",category:"system",displayKey:"?"},{id:"escape",key:"Escape",description:"Close modal / Cancel",category:"system",displayKey:"Esc"},{id:"command-palette",key:"k",ctrlKey:!0,description:"Open command palette",category:"system",displayKey:"âŒ˜K"}],d=(0,l.createContext)(void 0),u="taskflow-shortcut-preferences",y=null;function f(e){y=e}function m(e){let{children:t}=e,[a,s]=(0,l.useState)(!1),[f,m]=(0,l.useState)(()=>{try{let e=localStorage.getItem(u);return e?JSON.parse(e):{}}catch(e){return{}}}),p=(0,n.qD)(),k=(0,o.Z0)(),g=(0,l.useMemo)(()=>c,[]),h=(0,l.useCallback)(e=>!(e in f)||f[e],[f]);(0,l.useCallback)((e,t)=>{m(a=>{let r={...a,[e]:t};return localStorage.setItem(u,JSON.stringify(r)),r})},[]);let b=(0,l.useCallback)(()=>s(!0),[]),w=(0,l.useCallback)(()=>s(!1),[]),v=(0,l.useCallback)(()=>s(e=>!e),[]);return i({shortcuts:(0,l.useMemo)(()=>{let e=[];for(let t of g){let r;if(h(t.id)){switch(t.id){case"new-task":r=()=>{p.openTaskModal()};break;case"new-project":r=()=>{p.openProjectModal()};break;case"search":r=()=>{let e=document.querySelector("[data-search-input]");e&&e.focus()};break;case"help":r=v;break;case"escape":r=()=>{p.modal.isOpen?p.closeModal():a&&w()};break;case"view-dashboard":r=()=>p.setCurrentView("dashboard");break;case"view-kanban":r=()=>p.setCurrentView("kanban");break;case"view-list":r=()=>p.setCurrentView("list");break;case"view-calendar":r=()=>p.setCurrentView("calendar");break;case"view-timeline":r=()=>p.setCurrentView("timeline");break;case"view-people":r=()=>p.setCurrentView("people");break;case"command-palette":r=()=>{y&&y()};break;default:continue}e.push({key:t.key,ctrlKey:t.ctrlKey,metaKey:t.metaKey,shiftKey:t.shiftKey,altKey:t.altKey,action:r,description:t.description,enabled:!0})}}return e},[g,h,p,k,a,v,w]),enabled:!a}),i({shortcuts:[{key:"Escape",action:w,enabled:a}],enabled:!0}),(0,r.jsx)(d.Provider,{value:{shortcuts:g,isHelpOpen:a,openHelp:b,closeHelp:w,toggleHelp:v,isShortcutEnabled:h},children:t})}function p(){let e=(0,l.useContext)(d);if(!e)throw Error("useShortcuts must be used within a ShortcutProvider");return e}},32298:function(e,t,a){a.d(t,{SK:function(){return n},e0:function(){return o}});var r=a(57437),l=a(2265),s=a(28223);let i=(0,l.createContext)(void 0);function n(e){let{children:t,projectId:a}=e,[n,o]=(0,l.useState)([]),[c,d]=(0,l.useState)(!1),[u,y]=(0,l.useState)(null),f=(0,l.useMemo)(()=>a?n.filter(e=>void 0===e.project_id||null===e.project_id||e.project_id===a):n,[n,a]),m=(0,l.useCallback)(async()=>{d(!0),y(null);try{let e=await s.NJ();o(e)}catch(e){y(e instanceof Error?e.message:"Failed to fetch tags")}finally{d(!1)}},[]),p=(0,l.useCallback)(async e=>{d(!0),y(null);try{let t=await s.NJ(e);o(e=>{let a=new Set(e.map(e=>e.id)),r=t.filter(e=>!a.has(e.id));return[...e,...r]})}catch(e){y(e instanceof Error?e.message:"Failed to fetch tags")}finally{d(!1)}},[]),k=(0,l.useCallback)(async e=>{d(!0),y(null);try{let t=await s.ln(e);return o(e=>[...e,t]),t}catch(t){let e=t instanceof Error?t.message:"Failed to create tag";throw y(e),Error(e)}finally{d(!1)}},[]),g=(0,l.useCallback)(async(e,t)=>{d(!0),y(null);try{let a=await s.Lp(e,t);return o(t=>t.map(t=>t.id===e?a:t)),a}catch(t){let e=t instanceof Error?t.message:"Failed to update tag";throw y(e),Error(e)}finally{d(!1)}},[]),h=(0,l.useCallback)(async e=>{d(!0),y(null);try{await s.Pn(e),o(t=>t.filter(t=>t.id!==e))}catch(t){let e=t instanceof Error?t.message:"Failed to delete tag";throw y(e),Error(e)}finally{d(!1)}},[]),b=(0,l.useCallback)(()=>{y(null)},[]),w=(0,l.useCallback)(e=>n.find(t=>t.id===e),[n]);return(0,l.useEffect)(()=>{m()},[m]),(0,r.jsx)(i.Provider,{value:{tags:n,availableTags:f,loading:c,error:u,fetchTags:m,fetchAvailableTags:p,createTag:k,updateTag:g,deleteTag:h,clearError:b,getTagById:w},children:t})}function o(){let e=(0,l.useContext)(i);if(void 0===e)throw Error("useTags must be used within a TagProvider");return e}},50588:function(e,t,a){a.d(t,{Xi:function(){return d},o9:function(){return c}});var r=a(57437),l=a(2265),s=a(28223),i=a(92646);let n=(0,l.createContext)(void 0),o={};function c(e){let{children:t,projectId:a}=e,[c,d]=(0,l.useState)([]),[u,y]=(0,l.useState)(!1),[f,m]=(0,l.useState)(null),[p,k]=(0,l.useState)(o),[g,h]=(0,l.useState)([]),b=(0,i.pm)(),w=(0,l.useMemo)(()=>{let e=[...c];if(void 0!==p.project_id&&(e=e.filter(e=>e.project_id===p.project_id)),p.status&&(e=e.filter(e=>e.status===p.status)),p.priority&&(e=e.filter(e=>e.priority===p.priority)),p.due_date_from&&(e=e.filter(e=>e.due_date&&new Date(e.due_date)>=new Date(p.due_date_from))),p.due_date_to&&(e=e.filter(e=>e.due_date&&new Date(e.due_date)<=new Date(p.due_date_to))),p.search){let t=p.search.toLowerCase();e=e.filter(e=>e.title.toLowerCase().includes(t)||e.description.toLowerCase().includes(t))}return void 0!==p.assignee_id&&(e=e.filter(e=>{var t;return e.assignee_id===p.assignee_id||(null===(t=e.coAssignees)||void 0===t?void 0:t.some(e=>e.person_id===p.assignee_id))})),void 0!==p.tag_id&&(e=e.filter(e=>{var t;return null===(t=e.tags)||void 0===t?void 0:t.some(e=>e.tag_id===p.tag_id)})),e},[c,p]),v=(0,l.useCallback)(e=>g.includes(e),[g]),C=(0,l.useMemo)(()=>w.length>0&&w.every(e=>g.includes(e.id)),[w,g]),x=(0,l.useMemo)(()=>g.length>0&&!C,[g.length,C]),E=(0,l.useCallback)(e=>{h(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},[]),j=(0,l.useCallback)(()=>{h(w.map(e=>e.id))},[w]),_=(0,l.useCallback)(()=>{h([])},[]),F=(0,l.useCallback)(async e=>{y(!0),m(null);try{let t=await s.Ak(e);d(t)}catch(e){m(e instanceof Error?e.message:"Failed to fetch tasks")}finally{y(!1)}},[]),K=(0,l.useCallback)(async e=>{y(!0),m(null);try{let t=await s.Ak({project_id:e});d(t)}catch(e){m(e instanceof Error?e.message:"Failed to fetch tasks")}finally{y(!1)}},[]),S=(0,l.useCallback)(e=>{k(e)},[]),N=(0,l.useCallback)((e,t)=>{k(a=>({...a,[e]:t}))},[]),P=(0,l.useCallback)(()=>{k(o)},[]),M=(0,l.useCallback)(async e=>{y(!0),m(null);try{let t=await s.vr(e);return d(e=>[...e,t]),b.success("Task created",'"'.concat(t.title,'" has been created successfully.')),t}catch(t){let e=t instanceof Error?t.message:"Failed to create task";throw m(e),b.error("Failed to create task",e),Error(e)}finally{y(!1)}},[b]),T=(0,l.useCallback)(async(e,t)=>{y(!0),m(null);try{let a=await s.xJ(e,t);return d(t=>t.map(t=>t.id===e?a:t)),b.success("Task updated",'"'.concat(a.title,'" has been updated.')),a}catch(t){let e=t instanceof Error?t.message:"Failed to update task";throw m(e),b.error("Failed to update task",e),Error(e)}finally{y(!1)}},[b]),O=(0,l.useCallback)(async(e,t)=>{d(a=>a.map(a=>a.id===e?{...a,status:t}:a));try{let a=await s.QW(e,t);return d(t=>t.map(t=>t.id===e?a:t)),a}catch(a){d(t=>t.map(t=>t.id===e&&c.find(t=>t.id===e)||t));let t=a instanceof Error?a.message:"Failed to update task status";throw m(t),b.error("Failed to update status",t),Error(t)}},[c,b]),L=(0,l.useCallback)(async e=>{if(0===g.length)return b.warning("No tasks selected","Please select tasks to update."),{updated:0,tasks:[]};y(!0),m(null);try{let t=await s.NR({taskIds:g,updates:e});return d(e=>e.map(e=>t.tasks.find(t=>t.id===e.id)||e)),b.success("Tasks updated","".concat(t.updated," task").concat(1!==t.updated?"s":""," updated successfully.")),_(),t}catch(t){let e=t instanceof Error?t.message:"Failed to update tasks";throw m(e),b.error("Bulk update failed",e),Error(e)}finally{y(!1)}},[g,b,_]),A=(0,l.useCallback)(async()=>{if(0===g.length){b.warning("No tasks selected","Please select tasks to delete.");return}y(!0),m(null);try{let e=await s.y4(g);d(e=>e.filter(e=>!g.includes(e.id))),b.success("Tasks deleted","".concat(e.deleted," task").concat(1!==e.deleted?"s":""," deleted successfully.")),_()}catch(t){let e=t instanceof Error?t.message:"Failed to delete tasks";throw m(e),b.error("Bulk delete failed",e),Error(e)}finally{y(!1)}},[g,b,_]),z=(0,l.useCallback)(async(e,t)=>{y(!0),m(null);try{let a=await s.BU(e,t);d(t=>t.map(t=>t.id===e?a:t))}catch(t){let e=t instanceof Error?t.message:"Failed to set primary assignee";throw m(e),Error(e)}finally{y(!1)}},[]),D=(0,l.useCallback)(async(e,t,a)=>{y(!0),m(null);try{let r=await s.lb(e,{person_id:t,role:a});d(t=>t.map(t=>{if(t.id===e){let e=t.coAssignees||[];return{...t,coAssignees:[...e,r]}}return t}))}catch(t){let e=t instanceof Error?t.message:"Failed to add co-assignee";throw m(e),Error(e)}finally{y(!1)}},[]),B=(0,l.useCallback)(async(e,t)=>{y(!0),m(null);try{await s.Sk(e,t),d(a=>a.map(a=>{if(a.id===e){var r;let e=(null===(r=a.coAssignees)||void 0===r?void 0:r.filter(e=>e.person_id!==t))||[];return{...a,coAssignees:e}}return a}))}catch(t){let e=t instanceof Error?t.message:"Failed to remove co-assignee";throw m(e),Error(e)}finally{y(!1)}},[]),J=(0,l.useCallback)(async(e,t)=>{y(!0),m(null);try{let a=await s.yB(e,t);d(t=>t.map(t=>{if(t.id===e){let e=t.tags||[];return{...t,tags:[...e,a]}}return t}))}catch(t){let e=t instanceof Error?t.message:"Failed to add tag to task";throw m(e),Error(e)}finally{y(!1)}},[]),V=(0,l.useCallback)(async(e,t)=>{y(!0),m(null);try{await s.Vo(e,t),d(a=>a.map(a=>{if(a.id===e){var r;let e=(null===(r=a.tags)||void 0===r?void 0:r.filter(e=>e.tag_id!==t))||[];return{...a,tags:e}}return a}))}catch(t){let e=t instanceof Error?t.message:"Failed to remove tag from task";throw m(e),Error(e)}finally{y(!1)}},[]),G=(0,l.useCallback)(async e=>{let t=c.find(t=>t.id===e);y(!0),m(null);try{await s._5(e),d(t=>t.filter(t=>t.id!==e)),b.success("Task deleted",t?'"'.concat(t.title,'" has been deleted.'):"Task has been deleted.")}catch(t){let e=t instanceof Error?t.message:"Failed to delete task";throw m(e),b.error("Failed to delete task",e),Error(e)}finally{y(!1)}},[c,b]),I=(0,l.useCallback)(()=>{m(null)},[]),q=(0,l.useCallback)(async e=>{y(!0),m(null);try{return await s.Tt(e)}catch(t){let e=t instanceof Error?t.message:"Failed to fetch task tree";throw m(e),Error(e)}finally{y(!1)}},[]),W=(0,l.useCallback)(async e=>{y(!0),m(null);try{return await s.al(e)}catch(t){let e=t instanceof Error?t.message:"Failed to fetch task children";throw m(e),Error(e)}finally{y(!1)}},[]),Z=(0,l.useCallback)(async(e,t)=>{y(!0),m(null);try{let a=await s.y3(e,t);return d(e=>[...e,a]),b.success("Subtask created",'"'.concat(a.title,'" has been created as a subtask.')),a}catch(t){let e=t instanceof Error?t.message:"Failed to create subtask";throw m(e),b.error("Failed to create subtask",e),Error(e)}finally{y(!1)}},[b]),H=(0,l.useCallback)(async(e,t)=>{y(!0),m(null);try{let a=await s.bf(e,t);return d(t=>t.map(t=>t.id===e?a:t)),b.success("Task moved",t?"Task moved to new parent.":"Task moved to root level."),a}catch(t){let e=t instanceof Error?t.message:"Failed to move task";throw m(e),b.error("Failed to move task",e),Error(e)}finally{y(!1)}},[b]),U=(0,l.useCallback)(async e=>{y(!0),m(null);try{return await s.Bm(e)}catch(t){let e=t instanceof Error?t.message:"Failed to fetch root tasks";throw m(e),Error(e)}finally{y(!1)}},[]),R=(0,l.useCallback)(async(e,t)=>{y(!0),m(null);try{var a;let r=await s.st(e,t);return d(t=>t.map(t=>t.id===e?r:t)),b.success("Progress updated","Progress set to ".concat(null!==(a=t.progress_percent)&&void 0!==a?a:r.progress_percent,"%.")),r}catch(t){let e=t instanceof Error?t.message:"Failed to update task progress";throw m(e),b.error("Failed to update progress",e),Error(e)}finally{y(!1)}},[b]),X=(0,l.useCallback)(async e=>{y(!0),m(null);try{return await s.Ju(e)}catch(t){let e=t instanceof Error?t.message:"Failed to fetch task progress rollup";throw m(e),Error(e)}finally{y(!1)}},[]),Q=(0,l.useCallback)(e=>c.find(t=>t.id===e),[c]),$=(0,l.useCallback)(e=>w.filter(t=>t.status===e),[w]);return(0,l.useEffect)(()=>{null!=a?(K(a),k(e=>({...e,project_id:a}))):F()},[a,F,K]),(0,r.jsx)(n.Provider,{value:{tasks:c,filteredTasks:w,loading:u,error:f,selectedTaskIds:g,isTaskSelected:v,isAllSelected:C,isPartialSelected:x,filters:p,setFilters:S,updateFilter:N,clearFilters:P,fetchTasks:F,fetchTasksByProject:K,createTask:M,updateTask:T,updateTaskStatus:O,deleteTask:G,clearError:I,toggleTaskSelection:E,selectAllTasks:j,clearSelection:_,bulkUpdateTasks:L,bulkDeleteTasks:A,setPrimaryAssignee:z,addCoAssignee:D,removeCoAssignee:B,addTagToTask:J,removeTagFromTask:V,fetchTaskTree:q,getTaskChildren:W,createSubTask:Z,moveTask:H,fetchRootTasks:U,updateTaskProgress:R,getTaskProgressRollup:X,getTaskById:Q,getTasksByStatus:$},children:t})}function d(){let e=(0,l.useContext)(n);if(void 0===e)throw Error("useTasks must be used within a TaskProvider");return e}}}]);