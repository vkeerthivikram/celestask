"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[217],{94217:function(t,e,n){n.d(e,{C1:function(){return d},LZ:function(){return l},Z0:function(){return u},jI:function(){return s}});var a=n(57437),c=n(2265),o=n(28223),r=n(92646);let i=(0,c.createContext)(void 0);function s(t){let{children:e,currentProjectId:n}=t,[s,u]=(0,c.useState)([]),[l,d]=(0,c.useState)(null),[f,p]=(0,c.useState)([]),[h,y]=(0,c.useState)(!1),[w,m]=(0,c.useState)(null),g=(0,r.pm)(),j=(0,c.useCallback)(async()=>{y(!0),m(null);try{let t=await o.mW();if(u(t),!l&&t.length>0){if(n){let e=t.find(t=>t.id===n);e&&d(e)}else d(t[0])}else if(n){let e=t.find(t=>t.id===n);e&&d(e)}}catch(t){m(t instanceof Error?t.message:"Failed to fetch projects")}finally{y(!1)}},[l,n]),b=(0,c.useCallback)(t=>{if(null===t){d(null);return}let e=s.find(e=>e.id===t);e&&d(e)},[s]),T=(0,c.useCallback)(async t=>{y(!0),m(null);try{let e=await o.$L(t);return u(t=>[...t,e]),g.success("Project created",'"'.concat(e.name,'" has been created successfully.')),e}catch(e){let t=e instanceof Error?e.message:"Failed to create project";throw m(t),g.error("Failed to create project",t),Error(t)}finally{y(!1)}},[g]),E=(0,c.useCallback)(async(t,e)=>{y(!0),m(null);try{let n=await o.j4(t,e);return u(e=>e.map(e=>e.id===t?n:e)),(null==l?void 0:l.id)===t&&d(n),g.success("Project updated",'"'.concat(n.name,'" has been updated.')),n}catch(e){let t=e instanceof Error?e.message:"Failed to update project";throw m(t),g.error("Failed to update project",t),Error(t)}finally{y(!1)}},[l,g]),k=(0,c.useCallback)(async t=>{let e=s.find(e=>e.id===t);y(!0),m(null);try{if(await o.th(t),u(e=>e.filter(e=>e.id!==t)),(null==l?void 0:l.id)===t){let e=s.filter(e=>e.id!==t);d(e.length>0?e[0]:null)}g.success("Project deleted",e?'"'.concat(e.name,'" has been deleted.'):"Project has been deleted.")}catch(e){let t=e instanceof Error?e.message:"Failed to delete project";throw m(t),g.error("Failed to delete project",t),Error(t)}finally{y(!1)}},[l,s,g]),C=(0,c.useCallback)(()=>{m(null)},[]),v=(0,c.useCallback)(async()=>{y(!0),m(null);try{return await o.t$()}catch(e){let t=e instanceof Error?e.message:"Failed to fetch root projects";throw m(t),Error(t)}finally{y(!1)}},[]),S=(0,c.useCallback)(async t=>{y(!0),m(null);try{return await o.zm(t)}catch(e){let t=e instanceof Error?e.message:"Failed to fetch project tree";throw m(t),Error(t)}finally{y(!1)}},[]),P=(0,c.useCallback)(async t=>{y(!0),m(null);try{return await o.$_(t)}catch(e){let t=e instanceof Error?e.message:"Failed to fetch project children";throw m(t),Error(t)}finally{y(!1)}},[]),O=(0,c.useCallback)(async(t,e)=>{y(!0),m(null);try{let n=await o.Eq(t,e);return u(t=>[...t,n]),g.success("Sub-project created",'"'.concat(n.name,'" has been created as a sub-project.')),n}catch(e){let t=e instanceof Error?e.message:"Failed to create subproject";throw m(t),g.error("Failed to create sub-project",t),Error(t)}finally{y(!1)}},[g]),_=(0,c.useCallback)(async(t,e)=>{y(!0),m(null);try{let n=await o.uC(t,e);return u(e=>e.map(e=>e.id===t?n:e)),(null==l?void 0:l.id)===t&&d(n),g.success("Project moved",e?"Project moved to new parent.":"Project moved to root level."),n}catch(e){let t=e instanceof Error?e.message:"Failed to move project";throw m(t),g.error("Failed to move project",t),Error(t)}finally{y(!1)}},[l,g]),N=(0,c.useCallback)(async(t,e)=>{y(!0),m(null);try{let n=await o.F1(t,e);return u(e=>e.map(e=>e.id===t?n:e)),(null==l?void 0:l.id)===t&&d(n),g.success("Owner updated",e?"Project owner has been set.":"Project owner has been removed."),n}catch(e){let t=e instanceof Error?e.message:"Failed to set project owner";throw m(t),g.error("Failed to set owner",t),Error(t)}finally{y(!1)}},[l,g]),J=(0,c.useCallback)(async t=>{y(!0),m(null);try{let e=await o.Ec(t);return(null==l?void 0:l.id)===t&&p(e),e}catch(e){let t=e instanceof Error?e.message:"Failed to fetch project assignees";throw m(t),Error(t)}finally{y(!1)}},[l]),L=(0,c.useCallback)(async(t,e)=>{y(!0),m(null);try{let n=await o.K7(t,e);return(null==l?void 0:l.id)===t&&p(t=>[...t,n]),g.success("Assignee added","Team member has been added to the project."),n}catch(e){let t=e instanceof Error?e.message:"Failed to add project assignee";throw m(t),g.error("Failed to add assignee",t),Error(t)}finally{y(!1)}},[l,g]),F=(0,c.useCallback)(async(t,e)=>{y(!0),m(null);try{await o.ty(t,e),(null==l?void 0:l.id)===t&&p(t=>t.filter(t=>t.id!==e)),g.success("Assignee removed","Team member has been removed from the project.")}catch(e){let t=e instanceof Error?e.message:"Failed to remove project assignee";throw m(t),g.error("Failed to remove assignee",t),Error(t)}finally{y(!1)}},[l,g]);return(0,c.useEffect)(()=>{j()},[]),(0,c.useEffect)(()=>{null!=n&&b(n)},[n,b]),(0,a.jsx)(i.Provider,{value:{projects:s,currentProject:l,currentProjectAssignees:f,loading:h,error:w,fetchProjects:j,setCurrentProject:d,setCurrentProjectById:b,createProject:T,updateProject:E,deleteProject:k,clearError:C,fetchRootProjects:v,fetchProjectTree:S,getProjectChildren:P,createSubProject:O,moveProject:_,setProjectOwner:N,fetchProjectAssignees:J,addProjectAssignee:L,removeProjectAssignee:F},children:e})}function u(){let t=(0,c.useContext)(i);if(void 0===t)throw Error("useProjects must be used within a ProjectProvider");return t}function l(t,e){let n=[],a=new Map(t.map(t=>[String(t.id),t])),c=a.get(String(e));for(;c&&c.parent_project_id;){let t=a.get(String(c.parent_project_id));if(t)n.unshift(t),c=t;else break}return n}function d(){let{currentProject:t,setCurrentProjectById:e,projects:n}=u();return{selectedProject:t?String(t.id):null,selectProject:(0,c.useCallback)(t=>{e(t?parseInt(t,10):null)},[e]),currentProject:t,projects:n}}},92646:function(t,e,n){n.d(e,{VW:function(){return s},pm:function(){return u}});var a=n(57437),c=n(2265);let o={success:4e3,info:4e3,warning:5e3,error:6e3},r=(0,c.createContext)(void 0),i=0;function s(t){let{children:e}=t,[n,s]=(0,c.useState)([]),u=(0,c.useRef)(new Map);(0,c.useEffect)(()=>()=>{u.current.forEach(t=>clearTimeout(t)),u.current.clear()},[]);let l=(0,c.useCallback)(t=>{var e,n;let a="toast-".concat(Date.now(),"-").concat(++i),c=null!==(e=t.duration)&&void 0!==e?e:o[t.type],r={id:a,type:t.type,title:t.title,message:t.message,duration:c,dismissible:null===(n=t.dismissible)||void 0===n||n,undoAction:t.undoAction,undoLabel:t.undoLabel,createdAt:Date.now()};if(s(t=>[...t,r].slice(-5)),c>0){let t=setTimeout(()=>{d(a)},c);u.current.set(a,t)}return a},[]),d=(0,c.useCallback)(t=>{let e=u.current.get(t);e&&(clearTimeout(e),u.current.delete(t)),s(e=>e.filter(e=>e.id!==t))},[]),f=(0,c.useCallback)(()=>{u.current.forEach(t=>clearTimeout(t)),u.current.clear(),s([])},[]),p=(0,c.useCallback)((t,e,n)=>l({...n,type:"success",title:t,message:e}),[l]),h=(0,c.useCallback)((t,e,n)=>l({...n,type:"error",title:t,message:e}),[l]),y=(0,c.useCallback)((t,e,n)=>l({...n,type:"warning",title:t,message:e}),[l]),w=(0,c.useCallback)((t,e,n)=>l({...n,type:"info",title:t,message:e}),[l]);return(0,a.jsx)(r.Provider,{value:{toasts:n,showToast:l,dismissToast:d,dismissAllToasts:f,success:p,error:h,warning:y,info:w},children:e})}function u(){let t=(0,c.useContext)(r);if(!t)throw Error("useToast must be used within a ToastProvider");return t}},28223:function(t,e,n){n.d(e,{$L:function(){return r},$_:function(){return L},Ak:function(){return u},BU:function(){return w},Bm:function(){return W},Ec:function(){return x},Eq:function(){return U},F1:function(){return D},FR:function(){return tc},Hl:function(){return X},Ju:function(){return V},K7:function(){return R},KD:function(){return M},Kk:function(){return P},Lp:function(){return v},NJ:function(){return k},NR:function(){return Z},Oq:function(){return G},P5:function(){return te},Pn:function(){return S},QW:function(){return f},Qk:function(){return _},SP:function(){return tn},Sk:function(){return y},Tt:function(){return q},Vo:function(){return g},ZA:function(){return to},_5:function(){return p},aP:function(){return I},al:function(){return H},bf:function(){return Q},e1:function(){return tt},el:function(){return Y},f_:function(){return N},hi:function(){return ti},j4:function(){return i},jn:function(){return tr},jt:function(){return E},kH:function(){return j},kT:function(){return O},lb:function(){return h},ln:function(){return C},mW:function(){return o},oO:function(){return b},p6:function(){return T},rQ:function(){return ta},st:function(){return B},t$:function(){return J},th:function(){return s},ty:function(){return $},uC:function(){return A},vr:function(){return l},xJ:function(){return d},y3:function(){return K},y4:function(){return z},yB:function(){return m},zm:function(){return F}});let a="/api";async function c(t){if(!t.ok){var e;throw Error((null===(e=(await t.json().catch(()=>({error:{message:"An error occurred"}}))).error)||void 0===e?void 0:e.message)||"HTTP error! status: ".concat(t.status))}return(await t.json()).data}async function o(){return c(await fetch("".concat(a,"/projects")))}async function r(t){return c(await fetch("".concat(a,"/projects"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}))}async function i(t,e){return c(await fetch("".concat(a,"/projects/").concat(t),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}))}async function s(t){let e=await fetch("".concat(a,"/projects/").concat(t),{method:"DELETE"});await c(e)}async function u(t){let e=function(t){if(!t)return"";let e=new URLSearchParams;void 0!==t.project_id&&e.append("project_id",t.project_id.toString()),t.status&&e.append("status",t.status),t.priority&&e.append("priority",t.priority),t.due_date_from&&e.append("due_date_from",t.due_date_from),t.due_date_to&&e.append("due_date_to",t.due_date_to),t.search&&e.append("search",t.search),void 0!==t.assignee_id&&e.append("assignee_id",t.assignee_id.toString()),void 0!==t.tag_id&&e.append("tag_id",t.tag_id.toString());let n=e.toString();return n?"?".concat(n):""}(t);return c(await fetch("".concat(a,"/tasks").concat(e)))}async function l(t){return c(await fetch("".concat(a,"/tasks"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}))}async function d(t,e){return c(await fetch("".concat(a,"/tasks/").concat(t),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}))}async function f(t,e){return c(await fetch("".concat(a,"/tasks/").concat(t,"/status"),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:e})}))}async function p(t){let e=await fetch("".concat(a,"/tasks/").concat(t),{method:"DELETE"});await c(e)}async function h(t,e){return c(await fetch("".concat(a,"/tasks/").concat(t,"/assignees"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}))}async function y(t,e){let n=await fetch("".concat(a,"/tasks/").concat(t,"/assignees/").concat(e),{method:"DELETE"});await c(n)}async function w(t,e){return c(await fetch("".concat(a,"/tasks/").concat(t,"/assignee"),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({assignee_id:e})}))}async function m(t,e){return c(await fetch("".concat(a,"/tasks/").concat(t,"/tags"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tag_id:e})}))}async function g(t,e){let n=await fetch("".concat(a,"/tasks/").concat(t,"/tags/").concat(e),{method:"DELETE"});await c(n)}async function j(t){return c(await fetch("".concat(a,"/people").concat(t?"?project_id=".concat(t):"")))}async function b(t){return c(await fetch("".concat(a,"/people"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}))}async function T(t,e){return c(await fetch("".concat(a,"/people/").concat(t),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}))}async function E(t){let e=await fetch("".concat(a,"/people/").concat(t),{method:"DELETE"});await c(e)}async function k(t){return c(await fetch("".concat(a,"/tags").concat(t?"?project_id=".concat(t):"")))}async function C(t){return c(await fetch("".concat(a,"/tags"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}))}async function v(t,e){return c(await fetch("".concat(a,"/tags/").concat(t),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}))}async function S(t){let e=await fetch("".concat(a,"/tags/").concat(t),{method:"DELETE"});await c(e)}async function P(t,e){return c(await fetch("".concat(a,"/notes?entity_type=").concat(t,"&entity_id=").concat(e)))}async function O(t){return c(await fetch("".concat(a,"/notes"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}))}async function _(t,e){return c(await fetch("".concat(a,"/notes/").concat(t),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}))}async function N(t){let e=await fetch("".concat(a,"/notes/").concat(t),{method:"DELETE"});await c(e)}async function J(){return c(await fetch("".concat(a,"/projects/root")))}async function L(t){return c(await fetch("".concat(a,"/projects/").concat(t,"/children")))}async function F(t){return c(await fetch("".concat(a,"/projects/").concat(t,"/tree")))}async function U(t,e){return c(await fetch("".concat(a,"/projects/").concat(t,"/subprojects"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}))}async function A(t,e){return c(await fetch("".concat(a,"/projects/").concat(t,"/move"),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({parent_id:e})}))}async function D(t,e){return c(await fetch("".concat(a,"/projects/").concat(t,"/owner"),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({owner_id:e})}))}async function x(t){return c(await fetch("".concat(a,"/projects/").concat(t,"/assignees")))}async function R(t,e){return c(await fetch("".concat(a,"/projects/").concat(t,"/assignees"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}))}async function $(t,e){let n=await fetch("".concat(a,"/projects/").concat(t,"/assignees/").concat(e),{method:"DELETE"});await c(n)}async function H(t){return c(await fetch("".concat(a,"/tasks/").concat(t,"/children")))}async function q(t){return c(await fetch("".concat(a,"/tasks/").concat(t,"/tree")))}async function K(t,e){return c(await fetch("".concat(a,"/tasks/").concat(t,"/subtasks"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}))}async function Q(t,e){return c(await fetch("".concat(a,"/tasks/").concat(t,"/move"),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({parent_id:e})}))}async function W(t){return c(await fetch("".concat(a,"/projects/").concat(t,"/tasks/root")))}async function B(t,e){return c(await fetch("".concat(a,"/tasks/").concat(t,"/progress"),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}))}async function V(t){return c(await fetch("".concat(a,"/tasks/").concat(t,"/progress/rollup")))}async function Z(t){return c(await fetch("".concat(a,"/tasks/bulk"),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}))}async function z(t){return c(await fetch("".concat(a,"/tasks/bulk"),{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({taskIds:t})}))}async function I(t){return c(await fetch("".concat(a,"/custom-fields").concat(t?"?project_id=".concat(t):"")))}async function M(t){return c(await fetch("".concat(a,"/custom-fields"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}))}async function G(t,e){return c(await fetch("".concat(a,"/custom-fields/").concat(t),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}))}async function X(t){let e=await fetch("".concat(a,"/custom-fields/").concat(t),{method:"DELETE"});await c(e)}async function Y(t){return c(await fetch("".concat(a,"/tasks/").concat(t,"/custom-fields")))}async function tt(t,e,n){return c(await fetch("".concat(a,"/tasks/").concat(t,"/custom-fields/").concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({value:n})}))}async function te(t,e){let n=await fetch("".concat(a,"/tasks/").concat(t,"/custom-fields/").concat(e),{method:"DELETE"});await c(n)}async function tn(t,e){let n=new URLSearchParams;t&&n.append("project_id",t),e&&n.append("view_type",e);let o=n.toString()?"?".concat(n.toString()):"";return c(await fetch("".concat(a,"/saved-views").concat(o)))}async function ta(t){return c(await fetch("".concat(a,"/saved-views"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}))}async function tc(t,e){return c(await fetch("".concat(a,"/saved-views/").concat(t),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}))}async function to(t){let e=await fetch("".concat(a,"/saved-views/").concat(t),{method:"DELETE"});await c(e)}async function tr(t){return c(await fetch("".concat(a,"/saved-views/").concat(t,"/default"),{method:"PUT"}))}let ti={projects:{getAll:o,getOne:async function(t){return c(await fetch("".concat(a,"/projects/").concat(t)))},create:r,update:i,delete:s,getTasks:async function(t){return c(await fetch("".concat(a,"/projects/").concat(t,"/tasks")))},getRoot:J,getChildren:L,getDescendants:async function(t){return c(await fetch("".concat(a,"/projects/").concat(t,"/descendants")))},getTree:F,createSub:U,move:A,setOwner:D,getAssignees:x,addAssignee:R,removeAssignee:$},tasks:{getAll:u,getOne:async function(t){return c(await fetch("".concat(a,"/tasks/").concat(t)))},create:l,update:d,updateStatus:f,delete:p,getAssignees:async function(t){return c(await fetch("".concat(a,"/tasks/").concat(t,"/assignees")))},addAssignee:h,removeAssignee:y,setPrimaryAssignee:w,getTags:async function(t){return c(await fetch("".concat(a,"/tasks/").concat(t,"/tags")))},addTag:m,removeTag:g,getChildren:H,getDescendants:async function(t){return c(await fetch("".concat(a,"/tasks/").concat(t,"/descendants")))},getTree:q,createSub:K,move:Q,updateProgress:B,getProgressRollup:V,getRoot:W,bulkUpdate:Z,bulkDelete:z,getCustomFields:Y,setCustomField:tt,deleteCustomField:te},people:{getAll:j,getOne:async function(t){return c(await fetch("".concat(a,"/people/").concat(t)))},create:b,update:T,delete:E},tags:{getAll:k,getOne:async function(t){return c(await fetch("".concat(a,"/tags/").concat(t)))},create:C,update:v,delete:S},notes:{getAll:P,getOne:async function(t){return c(await fetch("".concat(a,"/notes/").concat(t)))},create:O,update:_,delete:N},customFields:{getAll:I,getOne:async function(t){return c(await fetch("".concat(a,"/custom-fields/").concat(t)))},create:M,update:G,delete:X},savedViews:{getAll:tn,getOne:async function(t){return c(await fetch("".concat(a,"/saved-views/").concat(t)))},create:ta,update:tc,delete:to,setDefault:tr},importExport:{exportData:async function(){let t=await fetch("".concat(a,"/export"));if(!t.ok){var e;throw Error((null===(e=(await t.json().catch(()=>({error:{message:"Export failed"}}))).error)||void 0===e?void 0:e.message)||"HTTP error! status: ".concat(t.status))}let n=await t.blob(),c=t.headers.get("Content-Disposition"),o="taskflow-export.json";if(c){let t=c.match(/filename="?(.+?)"?(?:;|$)/);t&&(o=t[1])}let r=URL.createObjectURL(n),i=document.createElement("a");i.href=r,i.download=o,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(r)},exportSqlite:async function(){let t=await fetch("".concat(a,"/export/sqlite"));if(!t.ok){var e;throw Error((null===(e=(await t.json().catch(()=>({error:{message:"SQLite export failed"}}))).error)||void 0===e?void 0:e.message)||"HTTP error! status: ".concat(t.status))}let n=await t.blob(),c=t.headers.get("Content-Disposition"),o="taskflow-backup.db";if(c){let t=c.match(/filename="?(.+?)"?(?:;|$)/);t&&(o=t[1])}let r=URL.createObjectURL(n),i=document.createElement("a");i.href=r,i.download=o,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(r)},getExportStatus:async function(){return c(await fetch("".concat(a,"/export/status")))},importData:async function(t,e){return c(await fetch("".concat(a,"/import?mode=").concat(e),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}))}}}}}]);